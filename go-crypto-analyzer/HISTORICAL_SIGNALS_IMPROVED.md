# 历史信号追踪功能改进说明

## 改进内容

### 1. 位置调整
- 历史信号追踪现在显示在**最底部**
- 顺序：分析结果 → 价格走势图 → 历史信号追踪

### 2. 增强的表格显示
新的表格包含更多信息：

| 列名 | 说明 | 示例 |
|------|------|------|
| 时间 | K线时间 | 01-02 15:04 |
| 价格 | 收盘价 | $112,930.24 |
| 综合得分 | 多指标加权得分 | -1.20 |
| **系统判断** | 基于得分的判断 | 强烈看涨信号 |
| RSI | 相对强弱指数 | 45.2 |
| MACD | MACD值（带颜色） | -234（红色） |
| 成交量 | 成交量比率 | 1.5x（绿色） |

### 3. 系统判断标准
```
综合得分 > 2.0    → 强烈看涨信号（绿色）
综合得分 > 0.5    → 偏多信号（黄色）
综合得分 < -2.0   → 强烈看跌信号（红色）
综合得分 < -0.5   → 偏空信号（黄色）
-0.5 ≤ 得分 ≤ 0.5 → 信号不明确
```

### 4. 优化的数据处理

#### 避免不必要的API请求
- 重用主分析已获取的OHLCV数据
- 不会为历史信号单独请求数据
- 使用滑动窗口技术，高效计算历史指标

#### 智能显示逻辑
- 自动调整显示的时间范围
- 数据不足时给出提示
- 最多显示24行，避免输出过长

### 5. 视觉优化

#### 颜色编码
- MACD: 正值绿色，负值红色
- 成交量: >1.5x绿色, <0.5x红色
- 系统判断: 根据信号强度着色

#### 信息提示
```
ℹ️  分析时间范围: 01-02 08:00 至 01-02 20:00
ℹ️  数据点: 共12个，每1个显示一次
```

## 示例输出

```
================================================================================
📊 历史信号追踪（过去12小时）
================================================================================

  ℹ️  分析时间范围: 01-02 08:00 至 01-02 20:00
  ℹ️  数据点: 共12个，每1个显示一次

     时间     |    价格    | 综合得分 |   系统判断    | RSI  | MACD  | 成交量
--------------+------------+----------+---------------+------+-------+--------
  01-02 08:00 | $112,156.78|  -2.30   | 强烈看跌信号  | 30.5 | -456  | 2.1x
  01-02 09:00 | $112,265.87|  -1.90   | 偏空信号      | 33.8 | -398  | 1.8x
  01-02 10:00 | $112,354.21|  -1.60   | 偏空信号      | 36.5 | -342  | 1.5x
  01-02 11:00 | $112,498.76|  -1.00   | 偏空信号      | 41.8 | -287  | 1.2x
  01-02 12:00 | $112,587.43|  -0.70   | 偏空信号      | 44.3 | -234  | 1.0x
  01-02 13:00 | $112,654.21|  -0.40   | 信号不明确    | 47.2 | -189  | 0.9x
  01-02 14:00 | $112,743.56|   0.10   | 信号不明确    | 50.5 | -145  | 0.8x
  01-02 15:00 | $112,832.91|   0.50   | 信号不明确    | 53.2 | -98   | 1.1x
  01-02 16:00 | $112,921.34|   0.90   | 偏多信号      | 55.8 | -52   | 1.3x
  01-02 17:00 | $113,010.45|   1.30   | 偏多信号      | 58.3 | -8    | 1.5x
  01-02 18:00 | $113,098.67|   1.70   | 偏多信号      | 60.7 |  35   | 1.7x
  01-02 19:00 | $113,187.23|   2.10   | 强烈看涨信号  | 63.1 |  78   | 1.9x
  01-02 20:00 | $113,276.45|   2.50   | 强烈看涨信号  | 65.4 | 121   | 2.1x

🔄 信号变化分析:
  平均得分: 0.15
  最高得分: 2.50 (20:00)
  最低得分: -2.30 (08:00)
  信号趋势: 转强 ↗
  当前位置: 可能超买
```

## 使用建议

1. **趋势判断**：
   - 观察"系统判断"列的变化
   - 从"强烈看跌"变为"强烈看涨"表示趋势反转

2. **入场时机**：
   - 系统判断从"信号不明确"转为明确信号
   - 综合得分突破关键水平（-0.5或0.5）

3. **风险提示**：
   - "可能超买"：考虑减仓或止盈
   - "可能超卖"：可能存在反弹机会

4. **综合分析**：
   - 结合RSI、MACD、成交量综合判断
   - 成交量放大（>1.5x）确认趋势

## 性能优化

1. **缓存利用**：
   - 历史信号分析使用已缓存的OHLCV数据
   - 不会触发额外的API请求

2. **计算优化**：
   - 滑动窗口避免重复计算
   - 只显示关键时间点，减少计算量

3. **显示优化**：
   - 最多24行，保持输出简洁
   - 自动调整时间间隔